difficulty: easy
expect:
- contains: COMPLIANT
script:
- prompt: |-
    You are a Kubernetes security reviewer checking resources for policy compliance.

    **Policy Requirement:**
    This policy enforces that container images must begin with a string from a specified list. The updated version, K8sAllowedReposv2, introduces support for exact match and glob-like syntax to enhance security: 1. Exact Match: By default, if the * character is not specified, the policy strictly checks for an exact match of the full registry, repository, and/or the image name. 2. Glob-like Syntax: Adding * at the end of a prefix allows prefix-based matching (e.g., registry.example.com/project/*). Only the * wildcard at the end of a string is supported. 3. Security Note: To avoid bypasses scenarios, ensure prefixes include a trailing / where appropriate (e.g., registry.example.com/project/*).

    **Resource to Review:**
    ```yaml
    apiVersion: v1
    kind: Pod
    metadata:
      name: opa-allowed
    spec:
      containers:
        - name: opa
          image: openpolicyagent/opa:0.9.2
          args:
            - "run"
            - "--server"
            - "--addr=localhost:8080"
          resources:
            limits:
              cpu: "100m"
              memory: "30Mi"
    ```
    Does this resource COMPLY with the policy requirement above?

    First, answer with exactly "COMPLIANT" or "NON-COMPLIANT".
    Then briefly explain your reasoning.
